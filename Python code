import pandas as pd
import matplotlib.pyplot as plt

# Load Data
df = pd.read_excel('order_fulfillment_cleaned.xlsx')

# Top 10 Sellers with Most Delivery Delays
seller_delays = df.groupby('SellerName')['DelayedFlag'].sum().sort_values(ascending=False).head(10)
print("Top 10 Sellers with Delays:\n", seller_delays)

# Region-wise Delay Rate (%)
region_delays = df.groupby('Region')['DelayedFlag'].mean() * 100
print("\nRegion-wise Delay Rate (%):\n", region_delays)

# Export Summaries for Power BI
seller_delays.to_csv('seller_delays_summary.csv')
region_delays.to_csv('region_delays_summary.csv')

# Daily Fulfillment Trend
df['OrderDate'] = pd.to_datetime(df['OrderDate'])
daily_fulfillment = df.groupby('OrderDate')['DelayedFlag'].mean() * 100

# Plot Trend
plt.figure(figsize=(10,6))
daily_fulfillment.plot(color='orange', marker='o', label='Delayed Orders %')
plt.title('Daily Delivery Delay Trend')
plt.xlabel('Date')
plt.ylabel('Delay Rate (%)')
plt.legend()
plt.grid(True)
plt.show()

# Export Trend Data
daily_fulfillment.to_csv('daily_fulfillment_trend.csv')
